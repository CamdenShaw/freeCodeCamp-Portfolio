"use strict";var google=window.google;$(document).ready(function(){var g=[],t=[],e=[{featureType:"administrative",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]}];var n=new google.maps.Map(document.getElementById("map"),{center:{lat:49.256994090673,lng:-123.13892841339},zoom:14,styles:e,disableDefaultUI:!0,zoomControl:!0}),o=document.getElementById("pac-input"),l=new google.maps.places.SearchBox(o);function a(){if(0===(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).length)g.forEach(function(e){0===e.length&&(t.push(new google.maps.Polygon({map:n,paths:e,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,draggable:!0,geodesic:!0,editable:!0})),i(!0),console.log("created new polygon in polygon array"))}),t.forEach(function(a,r){a.addListener("dragend",function(){for(var e=a.getPath(),o=[],t=e.getLength(),n=0;n<t;n++){var l=e.getAt(n).toUrlValue(15).split(",");o.push({lat:parseFloat(l[0]),lng:parseFloat(l[1])})}g[r]=o,i(!0)})});else{var e=t[t.length-1],o=g[g.length-1];console.log(o,"relevant coordinates"),e.setPaths(o),e.getPaths().forEach(function(e,o){e.addListener("set_at",function(){t.forEach(function(e,o){for(var t=e.getPath(),n=[],l=t.getLength(),a=0;a<l;a++){var r=t.getAt(a).toUrlValue(15).split(",");n.push({lat:parseFloat(r[0]),lng:parseFloat(r[1])})}g[o]=n,i(!0)})})})}}function i(){var l=0<arguments.length&&void 0!==arguments[0]&&arguments[0],a=0;l&&(document.getElementById("coordinates-box").innerHTML=""),g.forEach(function(e){a++;var o="";if(document.getElementById("coordinates-box").childElementCount<g.length||l)e.forEach(function(e){o+="<p>"+e.lat+", "+e.lng+"</p>"}),document.getElementById("coordinates-box").innerHTML+='\n                    <div class="polygon-'+a+'-coordinates">\n                        <h6 class="title coordinates">Polygon '+a+"</h6>\n                        "+o+"\n                    </div>";else if(a===g.length){var t=e[e.length-1].lat,n=e[e.length-1].lng;document.querySelector("#coordinates-box .polygon-"+a+"-coordinates").innerHTML+="<p>"+t+", "+n+"</p>"}})}n.addListener("bounds_changed",function(){l.setBounds(n.getBounds())}),l.addListener("places_changed",function(){var e=l.getPlaces();if(0!==e.length){var o=new google.maps.LatLngBounds;e.forEach(function(e){e.geometry?e.geometry.viewport?o.union(e.geometry.viewport):o.extend(e.geometry.location):console.log("Returned place contains no geometry")}),n.fitBounds(o)}}),console.log(g);var r=!0,s="",c=!0;$(".turn-on-polygon").click(function(){r?(console.log("turn on polygon"),c&&g.push([]),a(g[g.length-1]),c=!1,s=n.addListener("click",function(e){var o={lat:e.latLng.lat(),lng:e.latLng.lng()};console.log(o),function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};g[g.length-1].push(e)}(o),console.log(g),a(g),i(),2<g[g.length-1].length&&$(".turn-off-polygon").prop("disabled",!1)}),$(".turn-on-polygon").text("Stop Drawing"),r=!1):(google.maps.event.removeListener(s),0===g[g.length-1].length?$(".turn-on-polygon").text("Draw Polygon"):$(".turn-on-polygon").text("Edit Polygon"),r=!0)}),$(".turn-off-polygon").click(function(){$(".turn-off-polygon").prop("disabled",!0),$(".turn-on-polygon").text("Draw Polygon"),google.maps.event.removeListener(s),r=c=!0})});