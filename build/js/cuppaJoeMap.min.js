"use strict";var google=window.google;$(document).ready(function(){var r=[],n=[],e=[{featureType:"administrative",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]}];var t=new google.maps.Map(document.getElementById("map"),{center:{lat:49.256994090673,lng:-123.13892841339},zoom:14,styles:e,disableDefaultUI:!0,zoomControl:!0}),o=document.getElementById("pac-input"),l=new google.maps.places.SearchBox(o);function a(){if(0===(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).length)r.forEach(function(e){0===e.length&&(n.push(new google.maps.Polygon({map:t,paths:e,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,draggable:!0,geodesic:!0,editable:!0})),i(!0),console.log("created new polygon in polygon array"))}),n.forEach(function(a,s){a.addListener("dragend",function(){for(var e=a.getPath(),o=[],n=e.getLength(),t=0;t<n;t++){var l=e.getAt(t).toUrlValue(15).split(",");o.push({lat:parseFloat(l[0]),lng:parseFloat(l[1])})}r[s]=o,i(!0)})});else{var e=n[n.length-1],o=r[r.length-1];e.setPaths(o),e.getPaths().forEach(function(e,o){e.addListener("set_at",function(){n.forEach(function(e,o){for(var n=e.getPath(),t=[],l=n.getLength(),a=0;a<l;a++){var s=n.getAt(a).toUrlValue(15).split(",");t.push({lat:parseFloat(s[0]),lng:parseFloat(s[1])})}r[o]=t,i(!0)})}),e.addListener("insert_at",function(e){var o=this.getAt(e).toUrlValue(15).split(",");console.log("insert at",e,this,o),r[r.length-1].splice(e,0,{lat:parseFloat(o[0]),lng:parseFloat(o[1])}),i(!0)})})}}function i(){var l=0<arguments.length&&void 0!==arguments[0]&&arguments[0],a=0;l&&(document.getElementById("coordinates-box").innerHTML=""),r.forEach(function(e){a++;var o="";if(document.getElementById("coordinates-box").childElementCount<r.length||l)e.forEach(function(e){o+="<div>"+e.lat+", "+e.lng+"</div>"}),document.getElementById("coordinates-box").innerHTML+='\n                    <div class="polygon-'+a+'-coordinates">\n                        <h6 class="title coordinates">Polygon '+a+"</h6>\n                        "+o+"\n                    </div>";else if(a===r.length){var n=e[e.length-1].lat,t=e[e.length-1].lng;document.querySelector("#coordinates-box .polygon-"+a+"-coordinates").innerHTML+='<div class="lat-lng">'+n+", "+t+"</div>"}})}t.addListener("bounds_changed",function(){l.setBounds(t.getBounds())}),l.addListener("places_changed",function(){var e=l.getPlaces();if(0!==e.length){var o=new google.maps.LatLngBounds;e.forEach(function(e){e.geometry?e.geometry.viewport?o.union(e.geometry.viewport):o.extend(e.geometry.location):console.log("Returned place contains no geometry")}),t.fitBounds(o)}});var s=!0,g="",c=!0;$(".turn-on-polygon").click(function(){s=s?(console.log("turn on polygon"),console.log(r),c&&r.push([]),a(r[r.length-1]),c=!1,g=t.addListener("click",function(e){!function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};r[r.length-1].push(e)}({lat:e.latLng.lat(),lng:e.latLng.lng()}),a(r),i(),2<r[r.length-1].length&&($(".turn-off-polygon").prop("disabled",!1),$(".clear-last").prop("disabled",!1),$(".clear-all").prop("disabled",!1))}),$(".turn-on-polygon").text("Stop Drawing").removeClass("btn-success").addClass("btn-dark"),!1):(google.maps.event.removeListener(g),0===r[r.length-1].length?$(".turn-on-polygon").text("Draw Polygon").removeClass("btn-success").addClass("btn-dark"):$(".turn-on-polygon").text("Edit Polygon").removeClass("btn-dark").addClass("btn-info"),!0)}),$(".turn-off-polygon").click(function(){$(".turn-off-polygon").prop("disabled",!0),$(".turn-on-polygon").text("Draw Polygon").removeClass("btn-dark").removeClass("btn-info").addClass("btn-success"),google.maps.event.removeListener(g),s=c=!0}),$(".clear-last").click(function(){return n.pop().setMap(null),r.pop(),i(!0),google.maps.event.removeListener(g),c=s=!0,$(".turn-on-polygon").text("Draw Polygon").removeClass("btn-dark").removeClass("btn-info").addClass("btn-success"),void(0===n.length&&$(".map-form .btn").each(function(e,o){$(o).hasClass("turn-on-polygon")||$(o).prop("disabled",!0)}))}),$(".clear-all").click(function(){return r=[],n.forEach(function(e){e.setMap(null)}),$(".map-form .btn").each(function(e,o){$(o).hasClass("turn-on-polygon")||$(o).prop("disabled",!0)}),google.maps.event.removeListener(g),c=s=!0,$(".turn-on-polygon").text("Draw Polygon").removeClass("btn-dark").removeClass("btn-info").addClass("btn-success"),n=[],void(document.querySelector("#coordinates-box").innerHTML="")})});